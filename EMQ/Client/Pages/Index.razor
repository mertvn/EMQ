@page "/"
@using Microsoft.AspNetCore.Components
@using Microsoft.Extensions.Logging
@using EMQ.Shared.Core.UI
@using EMQ.Client.Components
@inject NavigationManager _navigation
@inject HttpClient _client
@inject ILogger<Index> _logger
@inject ClientUtils _clientUtils
@inject ClientConnectionManager _clientConnectionManager

<h1>Eroge Music Quiz</h1>

<div>
    @if (ClientState.Session != null && !LoginInProgress)
    {
        <div>
            Currently logged in as @ClientState.Session.Player.Username<br/>

            <button type="button" class="btn btn-primary" @onclick="Logout">Logout</button>
            <br/>
        </div>
    }
    else if (LoginInProgress || ClientState.Session == null)
    {
        <p>Welcome to EMQ, please login.</p>
        <div>

            <EditForm Model="@_loginModel" OnValidSubmit="@(() => Login(_loginModel))">
                <DataAnnotationsValidator/>
                <ValidationSummary/>

                <label for="Username">Username: </label>
                <br/>
                <InputText id="Username" type="text" @bind-Value="_loginModel.Username"/>
                <br/>

                @* Password:<br/> *@
                @* <input @bind="Password" type="password" name="Password"/><br/> *@

                <label for="VndbId">VNDB Id (Optional): </label>
                <br/>
                <InputText id="VndbId" type="text" @bind-Value="_loginModel.VndbId"/>
                <br/>

                <label for="VndbApiToken">VNDB API Token (Optional, only required if your list is private): </label>
                <br/>
                <InputText id="VndbApiToken" type="text" @bind-Value="_loginModel.VndbApiToken"/>
                <br/>

                <input style="margin-top: 5px" type="submit" class="btn btn-primary" value="Login" disabled="@(ClientState.Session != null || LoginInProgress)"/>
            </EditForm>

        </div>

        <div>
            @foreach (string item in LoginProgressDisplay)
            {
                <p>@item</p>
            }
        </div>
    }
</div>
